<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>차량 진단 파이프라인 v6.0</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const Arrow = () => (
      <div className="flex justify-center py-1">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#475569" strokeWidth="2">
          <path d="M12 5v14M5 12l7 7 7-7" />
        </svg>
      </div>
    );

    const ValidationBadge = ({ status }) => {
      const styles = {
        validated: 'bg-green-500/20 text-green-400 border-green-500/50',
        partial: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50',
        unvalidated: 'bg-slate-500/20 text-slate-400 border-slate-500/50',
        new: 'bg-purple-500/20 text-purple-400 border-purple-500/50',
      };
      const labels = {
        validated: '✓ 검증완료',
        partial: '◐ 부분검증',
        unvalidated: '○ 대기중',
        new: '★ 신규',
      };
      return (
        <span className={`text-xs px-2 py-0.5 rounded border ${styles[status]}`}>
          {labels[status]}
        </span>
      );
    };

    const TypeBadge = ({ type }) => {
      const styles = {
        neural: 'bg-purple-500/20 text-purple-300',
        symbolic: 'bg-green-500/20 text-green-300',
        hybrid: 'bg-blue-500/20 text-blue-300',
        physics: 'bg-orange-500/20 text-orange-300',
      };
      const labels = {
        neural: '신경망',
        symbolic: '기호적',
        hybrid: '하이브리드',
        physics: '물리기반',
      };
      return type ? (
        <span className={`text-xs px-2 py-0.5 rounded ${styles[type]}`}>
          {labels[type]}
        </span>
      ) : null;
    };

    const LLMBadge = ({ enabled }) => {
      return enabled ? (
        <span className="text-xs px-2 py-0.5 rounded bg-gradient-to-r from-pink-500/30 to-purple-500/30 text-pink-300 border border-pink-500/50 animate-pulse">
          ✨ LLM
        </span>
      ) : null;
    };

    // 개요 뷰 - 현재 결과 포함
    const ExecutiveView = () => {
      const stages = [
        { n: '0', title: '데이터 소스', desc: 'YouTube 오디오 (2733개) + 합성 진동 (6600개) + OBD', validation: 'validated', note: '멀티모달' },
        { n: '1', title: '합성 사전학습', desc: '물리기반 진동: 22개 고장 × 7개 엔진 × 시나리오', validation: 'new', note: '63.9% (22클래스)', physics: true },
        { n: '2', title: '오디오 인코딩', desc: 'AST (768차원) + CLAP 멀티스케일 (3072차원) = 3840차원', validation: 'validated', note: '52.4% (11클래스)' },
        { n: '2.5', title: '특징 융합', desc: 'PCA 512 → SVM RBF 분류', validation: 'validated', note: '최적 구성' },
        { n: '3', title: '증거 추출', desc: '11클래스 증상 + 이상 점수 (AUC=0.777)', validation: 'validated', note: 'AST+CLAP' },
        { n: '4', title: '지식 그래프 쿼리', desc: '고장 KB → 후보 가설 (진동 22개 + OBD 8개 고장)', validation: 'validated', note: '30개 고장 유형' },
        { n: '5', title: '연역적 필터링', desc: '물리적 제약조건으로 불가능한 고장 제거', validation: 'validated', note: '정밀도 100%' },
        { n: '6', title: '귀추적 순위화', desc: '증거 가중 베이지안 스코어링', validation: 'validated', note: 'Recall@3: 84.2%' },
        { n: '7', title: '출력', desc: '진단 + LLM 설명 + 조치사항', validation: 'validated', note: 'LLM 보고서', llm: true },
      ];

      return (
        <div className="space-y-1">
          {/* 현재 최고 결과 요약 */}
          <div className="bg-gradient-to-r from-green-900/30 to-blue-900/30 rounded-lg p-3 mb-4 border border-green-500/30">
            <div className="text-green-400 font-bold text-sm mb-2">현재 최고 성능 (2026-01-28)</div>
            <div className="grid grid-cols-3 gap-3 text-xs">
              <div className="bg-slate-900/50 rounded p-2 text-center">
                <div className="text-2xl font-bold text-orange-400">63.9%</div>
                <div className="text-slate-400">진동 인코더</div>
                <div className="text-slate-500">(22개 고장, 물리 보정)</div>
              </div>
              <div className="bg-slate-900/50 rounded p-2 text-center">
                <div className="text-2xl font-bold text-cyan-400">52.4%</div>
                <div className="text-slate-400">오디오 분류</div>
                <div className="text-slate-500">(11클래스, 품질 검증)</div>
              </div>
              <div className="bg-slate-900/50 rounded p-2 text-center">
                <div className="text-2xl font-bold text-purple-400">0.777</div>
                <div className="text-slate-400">이상탐지 AUC</div>
                <div className="text-slate-500">(AST+CLAP 앙상블)</div>
              </div>
            </div>
          </div>

          {stages.map((s, i) => (
            <div key={i}>
              <div className={`rounded-lg p-3 flex items-center justify-between ${s.llm ? 'bg-gradient-to-r from-slate-800/50 to-pink-900/20 border border-pink-500/30' : s.physics ? 'bg-gradient-to-r from-slate-800/50 to-orange-900/20 border border-orange-500/30' : 'bg-slate-800/50'}`}>
                <div className="flex items-center gap-3">
                  <span className="bg-slate-700 text-slate-300 text-xs font-bold w-6 h-6 rounded flex items-center justify-center">{s.n}</span>
                  <div>
                    <div className="text-white font-medium text-sm flex items-center gap-2">
                      {s.title}
                      <LLMBadge enabled={s.llm} />
                    </div>
                    <div className="text-slate-400 text-xs">{s.desc}</div>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  {s.note && <span className={`text-xs ${s.llm ? 'text-pink-400' : s.physics ? 'text-orange-400' : 'text-green-400'}`}>{s.note}</span>}
                  <ValidationBadge status={s.validation} />
                </div>
              </div>
              {i < stages.length - 1 && <Arrow />}
            </div>
          ))}
        </div>
      );
    };

    // 진동 사전학습 뷰 - 신규
    const VibrationView = () => {
      return (
        <div className="space-y-4 text-xs">
          <div className="text-center text-slate-400 mb-4">
            합성 진동 사전학습 파이프라인 (물리 우선 접근법)
          </div>

          {/* 왜 진동을 먼저 하는가 */}
          <div className="bg-gradient-to-r from-orange-900/30 to-yellow-900/30 rounded-lg p-4 border border-orange-500/50">
            <div className="text-orange-400 font-bold mb-2">왜 합성 진동을 앵커 모달리티로?</div>
            <div className="grid grid-cols-2 gap-3">
              <div className="bg-slate-900/50 rounded p-2">
                <div className="text-green-400 font-semibold">장점</div>
                <div className="text-slate-400 mt-1">
                  <div>• 물리 법칙이 결정론적 & 잘 이해됨</div>
                  <div>• 무제한 레이블 학습 데이터</div>
                  <div>• 동일한 고장 시그니처가 양쪽 모달리티에</div>
                  <div>• 녹음 품질 문제 없음</div>
                </div>
              </div>
              <div className="bg-slate-900/50 rounded p-2">
                <div className="text-cyan-400 font-semibold">전이 경로</div>
                <div className="text-slate-400 mt-1">
                  <div>• 엔진 블록 = 주철/알루미늄</div>
                  <div>• 동일한 공진 모드가 오디오에도</div>
                  <div>• 전달 함수만 다름</div>
                  <div>• 공유 임베딩 공간으로 전이 가능</div>
                </div>
              </div>
            </div>
          </div>

          {/* 22개 고장 유형 */}
          <div className="bg-slate-900 rounded-lg p-4 border border-slate-700">
            <div className="text-yellow-400 font-bold mb-3">22개 고장 유형 (OBD가 감지 못함!)</div>
            <div className="grid grid-cols-5 gap-2">
              <div className="bg-red-900/20 border border-red-500/30 rounded p-2">
                <div className="text-red-400 font-semibold text-xs mb-1">엔진 내부 (8개)</div>
                <div className="text-slate-400 text-xs space-y-0.5">
                  <div>• 커넥팅로드 베어링 (3단계)</div>
                  <div>• 메인 베어링</div>
                  <div>• 피스톤 슬랩</div>
                  <div>• 바노스 래틀</div>
                  <div>• 타이밍 체인</div>
                  <div>• 밸브트레인 틱</div>
                </div>
                <div className="text-red-300 text-xs mt-1">엔진 $10-20k</div>
              </div>
              <div className="bg-blue-900/20 border border-blue-500/30 rounded p-2">
                <div className="text-blue-400 font-semibold text-xs mb-1">보조장치 (5개)</div>
                <div className="text-slate-400 text-xs space-y-0.5">
                  <div>• 워터펌프</div>
                  <div>• 알터네이터</div>
                  <div>• 에어컨 컴프레서</div>
                  <div>• 파워스티어링</div>
                  <div>• 벨트 텐셔너</div>
                </div>
                <div className="text-blue-300 text-xs mt-1">멈춤 위험</div>
              </div>
              <div className="bg-purple-900/20 border border-purple-500/30 rounded p-2">
                <div className="text-purple-400 font-semibold text-xs mb-1">터보 (3개)</div>
                <div className="text-slate-400 text-xs space-y-0.5">
                  <div>• 터보 베어링</div>
                  <div>• 웨이스트게이트 래틀</div>
                  <div>• 부스트 누수</div>
                </div>
                <div className="text-purple-300 text-xs mt-1">터보 $3-8k</div>
              </div>
              <div className="bg-green-900/20 border border-green-500/30 rounded p-2">
                <div className="text-green-400 font-semibold text-xs mb-1">구동계 (3개)</div>
                <div className="text-slate-400 text-xs space-y-0.5">
                  <div>• 휠 베어링</div>
                  <div>• CV 조인트</div>
                  <div>• 디퍼렌셜</div>
                </div>
                <div className="text-green-300 text-xs mt-1">안전 위험!</div>
              </div>
              <div className="bg-orange-900/20 border border-orange-500/30 rounded p-2">
                <div className="text-orange-400 font-semibold text-xs mb-1">배기 (2개)</div>
                <div className="text-slate-400 text-xs space-y-0.5">
                  <div>• 배기 누출</div>
                  <div>• 히트쉴드</div>
                </div>
                <div className="text-orange-300 text-xs mt-1">화재 위험</div>
              </div>
            </div>
          </div>

          {/* 물리 모델 */}
          <div className="bg-green-900/20 rounded-lg p-4 border border-green-500/50">
            <div className="text-green-400 font-bold mb-3">물리 모델 (2026-01-28 수정)</div>
            <div className="grid grid-cols-2 gap-3">
              <div className="bg-slate-900 rounded p-2">
                <div className="text-yellow-400 font-semibold mb-2">저널 베어링 물리 (수정됨)</div>
                <div className="text-slate-400 text-xs">
                  <div className="text-red-400">이전 (오류): 볼-패스 주파수 (BPFO/BPFI)</div>
                  <div className="text-green-400 mt-1">수정 (정확):</div>
                  <div>• 로드 베어링: TDC 후 15°에서 크랭크각 연동</div>
                  <div>• 메인 베어링: 복합 하중 피크에서 1× 오더</div>
                  <div>• 오일 훨: 0.43× 축 속도 (심각한 경우만)</div>
                </div>
              </div>
              <div className="bg-slate-900 rounded p-2">
                <div className="text-cyan-400 font-semibold mb-2">현실적 베이스라인 물리</div>
                <div className="text-slate-400 text-xs">
                  <div>• 실린더별 연소 펄스</div>
                  <div>• 사이클간 변동성 (CoV 5-12%)</div>
                  <div>• 비틀림 진동 고조파</div>
                  <div>• 피스톤 2차 운동 (2× 오더)</div>
                  <div>• 온도 효과 (냉간 = 1.8배 악화)</div>
                </div>
              </div>
            </div>
          </div>

          {/* 엔진 구성 */}
          <div className="bg-blue-900/20 rounded-lg p-4 border border-blue-500/50">
            <div className="text-blue-400 font-bold mb-3">7개 엔진 구성</div>
            <div className="grid grid-cols-7 gap-1 text-center">
              {['I4', 'I4-주철', 'I6', 'V6-60', 'V6-90', 'V8', 'V8-주철'].map((eng, i) => (
                <div key={i} className="bg-slate-900 rounded p-2">
                  <div className="text-cyan-300 font-semibold">{eng}</div>
                  <div className="text-slate-500 text-xs">{['2차', '2차', '3차', '3차', '3차', '4차', '4차'][i]} 오더</div>
                </div>
              ))}
            </div>
            <div className="mt-2 text-slate-400 text-xs">
              재질 특성: 알루미늄 (가볍고 고주파) vs 주철 (무겁고 감쇠)
            </div>
          </div>

          {/* 데이터셋 & 결과 */}
          <div className="bg-purple-900/20 rounded-lg p-4 border border-purple-500/50">
            <div className="text-purple-400 font-bold mb-3">학습 결과</div>
            <div className="grid grid-cols-2 gap-3">
              <div className="bg-slate-900 rounded p-2">
                <div className="text-orange-400 font-semibold mb-2">원본 데이터셋 (1.35 GB)</div>
                <div className="text-slate-400 text-xs">
                  <div>• 6,600개 신호 (3 엔진 × 22 고장 × 50 × 2)</div>
                  <div>• 고정 RPM, 단순 물리</div>
                  <div className="text-green-400 mt-1">테스트 정확도: 81.9%</div>
                  <div className="text-slate-500">(쉬운 신호)</div>
                </div>
              </div>
              <div className="bg-slate-900 rounded p-2 border border-green-500/30">
                <div className="text-green-400 font-semibold mb-2">V2 물리 보정 (2.7 GB) ⭐</div>
                <div className="text-slate-400 text-xs">
                  <div>• 6,600개 신호 (3 엔진 × 5 시나리오 × 22 × 2 × 10)</div>
                  <div>• 시변 RPM, 정확한 물리</div>
                  <div className="text-yellow-400 mt-1">테스트 정확도: 63.9%</div>
                  <div className="text-slate-500">(현실적 = 어렵지만 전이 우수)</div>
                </div>
              </div>
            </div>
          </div>

          {/* 클래스별 결과 */}
          <div className="bg-slate-900 rounded-lg p-4 border border-slate-700">
            <div className="text-slate-300 font-bold mb-3">안전 핵심 고장 검출</div>
            <div className="grid grid-cols-3 gap-2">
              {[
                { fault: 'wheel_bearing', acc: '100%', risk: '휠 분리' },
                { fault: 'turbo_bearing', acc: '100%', risk: '엔진 손상' },
                { fault: 'differential', acc: '100%', risk: '구동계 고장' },
                { fault: 'main_bearing', acc: '96.5%', risk: '엔진 세이즈' },
                { fault: 'rod_severe', acc: '92.1%', risk: '치명적' },
                { fault: 'cv_joint', acc: '85.7%', risk: '구동계 고장' },
              ].map((f, i) => (
                <div key={i} className="bg-green-900/20 border border-green-500/30 rounded p-2 text-center">
                  <div className="text-green-400 font-mono text-xs">{f.fault}</div>
                  <div className="text-2xl font-bold text-white">{f.acc}</div>
                  <div className="text-red-400 text-xs">{f.risk}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // 오디오 분류 뷰
    const AudioView = () => {
      return (
        <div className="space-y-4 text-xs">
          <div className="text-center text-slate-400 mb-4">
            오디오 분류 파이프라인 (기반 모델)
          </div>

          {/* 오디오 처리 체인 */}
          <div className="bg-cyan-900/20 rounded-lg p-4 border border-cyan-500/50">
            <div className="text-cyan-400 font-bold mb-3">오디오 처리 파이프라인</div>
            <div className="bg-slate-900 rounded p-3 font-mono text-slate-400">
              <div>원본 오디오 (wav) → 48kHz 리샘플링 → 모노</div>
              <div className="text-slate-500 mt-1">↓</div>
              <div className="text-cyan-300">AST 인코더 (16kHz) → 768차원 임베딩</div>
              <div className="text-pink-300">CLAP 멀티스케일 (3s, 5s, 7s) → 3072차원</div>
              <div className="text-slate-500 mt-1">↓</div>
              <div className="text-yellow-300">결합: 3840차원 → PCA 512 (93.9% 분산)</div>
              <div className="text-slate-500 mt-1">↓</div>
              <div className="text-green-300">SVM RBF 분류기 → 11개 클래스</div>
            </div>
          </div>

          {/* 데이터셋 통계 */}
          <div className="bg-green-900/20 rounded-lg p-4 border border-green-500/50">
            <div className="text-green-400 font-bold mb-3">데이터셋: 2,733개 샘플 (품질 검증)</div>
            <div className="grid grid-cols-2 gap-3">
              <div className="bg-slate-900 rounded p-2">
                <div className="text-orange-400 font-semibold mb-2">고장 샘플: 2,304개</div>
                <div className="text-slate-400 text-xs space-y-0.5">
                  <div>tick: 419 | rattle: 341 | whine: 322</div>
                  <div>knock: 269 | misfire: 224 | grind: 199</div>
                  <div>hiss: 178 | clunk: 152 | squeal: 117</div>
                  <div>wheel_bearing: 83</div>
                </div>
              </div>
              <div className="bg-slate-900 rounded p-2">
                <div className="text-cyan-400 font-semibold mb-2">정상 샘플: 429개</div>
                <div className="text-slate-400 text-xs">
                  <div>healthy_idle: 201</div>
                  <div>healthy_revving: 228</div>
                </div>
                <div className="text-green-400 mt-2 text-xs">품질: Freesound 이상치 제거</div>
              </div>
            </div>
          </div>

          {/* 클래스별 결과 */}
          <div className="bg-purple-900/20 rounded-lg p-4 border border-purple-500/50">
            <div className="text-purple-400 font-bold mb-3">V15 클래스별 정확도 (전체 52.4%)</div>
            <div className="grid grid-cols-4 gap-2">
              {[
                { cls: 'healthy (정상)', acc: 80, color: 'green' },
                { cls: 'misfire (실화)', acc: 53, color: 'cyan' },
                { cls: 'rattle (덜컹)', acc: 50, color: 'blue' },
                { cls: 'knock (노킹)', acc: 48, color: 'yellow' },
                { cls: 'wheel_bearing', acc: 46, color: 'orange' },
                { cls: 'tick (틱)', acc: 45, color: 'pink' },
                { cls: 'whine (윙)', acc: 42, color: 'purple' },
                { cls: 'hiss (쉬)', acc: 37, color: 'slate' },
                { cls: 'clunk (쿵)', acc: 33, color: 'red' },
                { cls: 'squeal (끽)', acc: 33, color: 'red' },
                { cls: 'grind (갈림)', acc: 32, color: 'red' },
              ].map((c, i) => (
                <div key={i} className="bg-slate-900 rounded p-2">
                  <div className="flex justify-between items-center">
                    <span className="text-slate-300 text-xs">{c.cls}</span>
                    <span className={`font-bold ${c.acc >= 50 ? 'text-green-400' : c.acc >= 40 ? 'text-yellow-400' : 'text-red-400'}`}>{c.acc}%</span>
                  </div>
                  <div className="mt-1 h-1 bg-slate-700 rounded">
                    <div className={`h-1 rounded ${c.acc >= 50 ? 'bg-green-500' : c.acc >= 40 ? 'bg-yellow-500' : 'bg-red-500'}`} style={{width: `${c.acc}%`}}></div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* 소리 분류 체계 */}
          <div className="bg-yellow-900/20 rounded-lg p-4 border border-yellow-500/50">
            <div className="text-yellow-400 font-bold mb-3">11클래스 소리 분류 체계</div>
            <div className="grid grid-cols-3 gap-2">
              <div className="bg-red-900/20 border border-red-500/30 rounded p-2">
                <div className="text-red-400 font-semibold text-xs mb-1">충격성</div>
                <div className="text-slate-400 text-xs">
                  <div>knock - 무거운 충격</div>
                  <div>tick - 빠른 클릭</div>
                  <div>clunk - 단발 쿵</div>
                </div>
              </div>
              <div className="bg-blue-900/20 border border-blue-500/30 rounded p-2">
                <div className="text-blue-400 font-semibold text-xs mb-1">음조성</div>
                <div className="text-slate-400 text-xs">
                  <div>whine - 기어/베어링 음</div>
                  <div>squeal - 고음 마찰</div>
                  <div>misfire - 거친 맥동</div>
                </div>
              </div>
              <div className="bg-green-900/20 border border-green-500/30 rounded p-2">
                <div className="text-green-400 font-semibold text-xs mb-1">잡음/광대역</div>
                <div className="text-slate-400 text-xs">
                  <div>rattle - 느슨한 부품</div>
                  <div>hiss - 공기/유체 누출</div>
                  <div>grind - 금속간 마찰</div>
                </div>
              </div>
            </div>
            <div className="mt-2 bg-slate-900/50 rounded p-2 text-center">
              <span className="text-cyan-400">+ healthy</span> <span className="text-slate-400">|</span> <span className="text-orange-400">+ wheel_bearing</span>
            </div>
          </div>

          {/* 실험 이력 */}
          <div className="bg-slate-900 rounded-lg p-4 border border-slate-700">
            <div className="text-slate-300 font-bold mb-3">실험 리더보드</div>
            <div className="space-y-1">
              {[
                { exp: 'AST+CLAP (v15, 품질검증)', acc: '52.4%', best: true },
                { exp: 'AST+CLAP (v13, 확장)', acc: '51.3%', best: false },
                { exp: 'AST+CLAP (v11, 정제)', acc: '48.3%', best: false },
                { exp: 'AST+CLAP (v9, +Freesound)', acc: '42.8%', best: false },
                { exp: 'CED + AST+CLAP (PCA 256)', acc: '45.6%', best: false },
                { exp: 'PANNs CNN14 (PCA 512)', acc: '38.5%', best: false },
                { exp: 'AudioMAE (PCA 512)', acc: '31.8%', best: false },
              ].map((e, i) => (
                <div key={i} className={`flex justify-between p-2 rounded ${e.best ? 'bg-green-900/30 border border-green-500/50' : 'bg-slate-800/50'}`}>
                  <span className={e.best ? 'text-green-400' : 'text-slate-400'}>{e.exp}</span>
                  <span className={`font-bold ${e.best ? 'text-green-400' : 'text-slate-500'}`}>{e.acc}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // 파이프라인 뷰 - 상세 단계
    const PipelineView = () => {
      const [expanded, setExpanded] = useState(null);

      const stages = [
        {
          n: '0', title: '데이터 소스', type: 'hybrid', validation: 'validated',
          content: (
            <div className="grid grid-cols-3 gap-2 text-xs">
              <div className="bg-orange-900/30 border border-orange-500/50 rounded p-2 text-center">
                <div className="text-2xl">📳</div>
                <div className="text-orange-400 font-medium">합성 진동</div>
                <div className="text-slate-400">6,600개 신호</div>
                <div className="text-slate-500">물리 기반</div>
              </div>
              <div className="bg-cyan-900/30 border border-cyan-500/50 rounded p-2 text-center">
                <div className="text-2xl">🎤</div>
                <div className="text-cyan-400 font-medium">YouTube 오디오</div>
                <div className="text-slate-400">2,733개 샘플</div>
                <div className="text-slate-500">품질 검증</div>
              </div>
              <div className="bg-blue-900/30 border border-blue-500/50 rounded p-2 text-center">
                <div className="text-2xl">📊</div>
                <div className="text-blue-400 font-medium">OBD-II</div>
                <div className="text-slate-400">14 PIDs + DTCs</div>
                <div className="text-slate-500">합성 페어링</div>
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-orange-900/20 border border-orange-500/30 rounded p-3">
                <div className="text-orange-400 font-semibold mb-2">합성 진동 데이터 생성 과정</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs space-y-1">
                  <div className="text-slate-500"># 1. 물리 시뮬레이터 초기화</div>
                  <div>VibrationFaultSimulator(engine_type=<span className="text-cyan-300">"inline_4"</span>)</div>
                  <div className="text-slate-500 mt-2"># 2. 고장 유형 선택 (22가지)</div>
                  <div>fault = <span className="text-yellow-300">ROD_BEARING_MID</span></div>
                  <div className="text-slate-500 mt-2"># 3. 운전 조건 설정</div>
                  <div>rpm=<span className="text-green-300">2500</span>, load=<span className="text-green-300">50%</span>, temp=<span className="text-green-300">90°C</span></div>
                  <div className="text-slate-500 mt-2"># 4. 신호 생성 (2초, 25.6kHz)</div>
                  <div>signal = simulator.generate() → <span className="text-yellow-300">[51200 samples]</span></div>
                </div>
                <div className="mt-2 text-slate-400">
                  <strong>물리 모델:</strong> 엔진 구조 공진 + 베어링 충격 + 연소 펄스 + 비틀림 진동 + 센서 노이즈
                </div>
              </div>
              <div className="bg-cyan-900/20 border border-cyan-500/30 rounded p-3">
                <div className="text-cyan-400 font-semibold mb-2">YouTube 오디오 수집 및 전처리</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs space-y-1">
                  <div className="text-slate-500"># 1. 검색 및 다운로드</div>
                  <div>query = <span className="text-cyan-300">"rod knock sound engine"</span></div>
                  <div>yt-dlp → audio.wav</div>
                  <div className="text-slate-500 mt-2"># 2. 전처리</div>
                  <div>리샘플링: <span className="text-yellow-300">48kHz</span> (CLAP 네이티브)</div>
                  <div>모노 변환 + 정규화 [-1, 1]</div>
                  <div className="text-slate-500 mt-2"># 3. 품질 검증</div>
                  <div>CLAP 임베딩 → 코사인 유사도 → 이상치 제거</div>
                </div>
              </div>
              <div className="bg-blue-900/20 border border-blue-500/30 rounded p-3">
                <div className="text-blue-400 font-semibold mb-2">OBD-II 합성 페어링</div>
                <div className="text-slate-400">
                  <div>• 오디오 레이블 → OBD 고장 유형 매핑</div>
                  <div>• 예: <span className="text-cyan-300">rod_knock</span> → STFT +12%, LTFT +18%</div>
                  <div>• ±10% 노이즈 추가로 과적합 방지</div>
                </div>
              </div>
            </div>
          ),
        },
        {
          n: '1', title: '진동 사전학습', type: 'physics', validation: 'new',
          content: (
            <div className="space-y-2 text-xs">
              <div className="grid grid-cols-3 gap-2">
                <div className="bg-orange-900/30 border border-orange-500/50 rounded p-2 text-center">
                  <div className="text-orange-400 font-semibold">시뮬레이터</div>
                  <div className="text-slate-400">22개 고장 유형</div>
                  <div className="text-slate-400">7개 엔진 구성</div>
                </div>
                <div className="bg-green-900/30 border border-green-500/50 rounded p-2 text-center">
                  <div className="text-green-400 font-semibold">인코더</div>
                  <div className="text-slate-400">CNN → 256차원</div>
                  <div className="text-slate-400">스펙트로그램 입력</div>
                </div>
                <div className="bg-purple-900/30 border border-purple-500/50 rounded p-2 text-center">
                  <div className="text-purple-400 font-semibold">결과</div>
                  <div className="text-white font-bold">63.9%</div>
                  <div className="text-slate-400">(현실적 물리)</div>
                </div>
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-orange-900/20 border border-orange-500/30 rounded p-3">
                <div className="text-orange-400 font-semibold mb-2">물리 시뮬레이터 작동 원리</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 베이스라인 신호 생성</div>
                  <div>baseline = combustion_pulses(firing_order) <span className="text-slate-500"># 실린더별 연소</span></div>
                  <div>         + torsional_vibration(harmonics) <span className="text-slate-500"># 크랭크 비틀림</span></div>
                  <div>         + piston_secondary(2x_order) <span className="text-slate-500"># 피스톤 측압</span></div>
                  <div className="text-slate-500 mt-2"># 고장 신호 추가</div>
                  <div>fault_sig = bearing_impact(crank_angle=15°) <span className="text-slate-500"># TDC 후 15°</span></div>
                  <div>          × structural_transfer_function <span className="text-slate-500"># 엔진 블록 공진</span></div>
                  <div className="text-slate-500 mt-2"># 최종 신호</div>
                  <div>signal = baseline + fault_sig + sensor_noise</div>
                </div>
                <div className="mt-2 grid grid-cols-2 gap-2">
                  <div className="bg-slate-800 rounded p-2">
                    <div className="text-yellow-400 font-semibold">저널 베어링 물리</div>
                    <div className="text-slate-400 mt-1">
                      <div>• 로드 베어링: 2× 오더 (TDC 충격)</div>
                      <div>• 메인 베어링: 1× 오더 (하중 피크)</div>
                      <div>• 오일 훨: 0.43× (심각시)</div>
                    </div>
                  </div>
                  <div className="bg-slate-800 rounded p-2">
                    <div className="text-cyan-400 font-semibold">엔진 구조 모드</div>
                    <div className="text-slate-400 mt-1">
                      <div>• 1차 굽힘: 800-1200 Hz</div>
                      <div>• 크랭크케이스 호흡: 1500-2500 Hz</div>
                      <div>• 베어링 하우징: 3000-5000 Hz</div>
                    </div>
                  </div>
                </div>
              </div>
              <div className="bg-green-900/20 border border-green-500/30 rounded p-3">
                <div className="text-green-400 font-semibold mb-2">CNN 인코더 아키텍처</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 입력: 시계열 신호</div>
                  <div>signal[51200] → <span className="text-cyan-300">SignalToSpectrogram</span>(n_mels=64)</div>
                  <div className="text-slate-500 mt-1"># CNN 블록 (4단계)</div>
                  <div>Block1: (1,64,T) → Conv+BN+ReLU+Pool → (32,32,T/2)</div>
                  <div>Block2: (32,32,T/2) → Conv+BN+ReLU+Pool → (64,16,T/4)</div>
                  <div>Block3: (64,16,T/4) → Conv+BN+ReLU+Pool → (128,8,T/8)</div>
                  <div>Block4: (128,8,T/8) → Conv+BN+ReLU+Pool → (256,4,T/16)</div>
                  <div className="text-slate-500 mt-1"># 출력: 임베딩</div>
                  <div>GlobalAvgPool → MLP → L2Norm → <span className="text-yellow-300">embedding[256]</span></div>
                </div>
                <div className="mt-2 text-slate-400">
                  <strong>학습:</strong> 30 에포크, batch=32, lr=1e-4, CrossEntropyLoss
                </div>
              </div>
            </div>
          ),
        },
        {
          n: '2', title: '오디오 특징 추출', type: 'neural', validation: 'validated',
          content: (
            <div className="space-y-2 text-xs">
              <div className="grid grid-cols-3 gap-2">
                <div className="bg-cyan-900/30 border border-cyan-500/50 rounded p-2 text-center">
                  <div className="text-cyan-400 font-semibold">AST</div>
                  <div className="text-slate-400">768차원</div>
                  <div className="text-slate-400">16kHz</div>
                </div>
                <div className="bg-pink-900/30 border border-pink-500/50 rounded p-2 text-center">
                  <div className="text-pink-400 font-semibold">CLAP</div>
                  <div className="text-slate-400">3072차원 (멀티스케일)</div>
                  <div className="text-slate-400">48kHz</div>
                </div>
                <div className="bg-yellow-900/30 border border-yellow-500/50 rounded p-2 text-center">
                  <div className="text-yellow-400 font-semibold">결합</div>
                  <div className="text-slate-400">3840차원</div>
                  <div className="text-slate-400">→ PCA 512</div>
                </div>
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-cyan-900/20 border border-cyan-500/30 rounded p-3">
                <div className="text-cyan-400 font-semibold mb-2">AST (Audio Spectrogram Transformer)</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 1. 전처리</div>
                  <div>audio → resample(<span className="text-yellow-300">16kHz</span>) → normalize</div>
                  <div className="text-slate-500 mt-1"># 2. 스펙트로그램 변환</div>
                  <div>mel_spec = MelSpectrogram(n_mels=128, hop=160)</div>
                  <div className="text-slate-500 mt-1"># 3. 패치 임베딩</div>
                  <div>patches = split_into_patches(16×16) → linear_projection</div>
                  <div className="text-slate-500 mt-1"># 4. Transformer 인코더</div>
                  <div>12 layers × (Self-Attention + FFN)</div>
                  <div className="text-slate-500 mt-1"># 5. 출력</div>
                  <div>[CLS] token → <span className="text-yellow-300">embedding[768]</span></div>
                </div>
                <div className="mt-2 text-slate-400">
                  <strong>사전학습:</strong> AudioSet (2M 클립, 527 클래스)
                </div>
              </div>
              <div className="bg-pink-900/20 border border-pink-500/30 rounded p-3">
                <div className="text-pink-400 font-semibold mb-2">CLAP 멀티스케일 특징 추출</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 멀티스케일 윈도우 (3개 시간 척도)</div>
                  <div>windows = [<span className="text-cyan-300">3초</span>, <span className="text-cyan-300">5초</span>, <span className="text-cyan-300">7초</span>]</div>
                  <div className="text-slate-500 mt-1"># 각 윈도우에서 CLAP 임베딩 추출</div>
                  <div>emb_3s = CLAP.encode(audio[:3s]) → [512]</div>
                  <div>emb_5s = CLAP.encode(audio[:5s]) → [512]</div>
                  <div>emb_7s = CLAP.encode(audio[:7s]) → [512]</div>
                  <div className="text-slate-500 mt-1"># 풀링 연산</div>
                  <div>mean_pool = mean([emb_3s, emb_5s, emb_7s]) → [512]</div>
                  <div>max_pool = max([emb_3s, emb_5s, emb_7s]) → [512]</div>
                  <div>std_pool = std([emb_3s, emb_5s, emb_7s]) → [512]</div>
                  <div className="text-slate-500 mt-1"># 최종 결합</div>
                  <div>concat([emb_3s, emb_5s, emb_7s, mean, max, std])</div>
                  <div>→ <span className="text-yellow-300">CLAP_features[3072]</span></div>
                </div>
              </div>
              <div className="bg-yellow-900/20 border border-yellow-500/30 rounded p-3">
                <div className="text-yellow-400 font-semibold mb-2">특징 결합 및 차원 축소</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># AST + CLAP 결합</div>
                  <div>combined = concat([AST[768], CLAP[3072]])</div>
                  <div>→ <span className="text-cyan-300">combined[3840]</span></div>
                  <div className="text-slate-500 mt-2"># PCA 차원 축소</div>
                  <div>PCA(n_components=512, whiten=True)</div>
                  <div>분산 유지율: <span className="text-green-300">93.9%</span></div>
                  <div>→ <span className="text-yellow-300">features[512]</span></div>
                </div>
                <div className="mt-2 text-slate-400">
                  <strong>효과:</strong> 노이즈 제거 + 7배 압축 + 일반화 성능 +1% 향상
                </div>
              </div>
            </div>
          ),
        },
        {
          n: '3', title: '분류 & 이상탐지', type: 'hybrid', validation: 'validated',
          content: (
            <div className="space-y-2 text-xs">
              <div className="grid grid-cols-2 gap-2">
                <div className="bg-green-900/30 border border-green-500/50 rounded p-2">
                  <div className="text-green-400 font-semibold">11클래스 분류기</div>
                  <div className="text-slate-400">SVM RBF + 클래스 가중치</div>
                  <div className="text-white font-bold">52.4% 정확도</div>
                </div>
                <div className="bg-purple-900/30 border border-purple-500/50 rounded p-2">
                  <div className="text-purple-400 font-semibold">이상 탐지</div>
                  <div className="text-slate-400">AST+CLAP + Isolation Forest</div>
                  <div className="text-white font-bold">AUC = 0.777</div>
                </div>
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-green-900/20 border border-green-500/30 rounded p-3">
                <div className="text-green-400 font-semibold mb-2">SVM RBF 분류기 작동 원리</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># RBF (Radial Basis Function) 커널</div>
                  <div>K(x, y) = exp(-γ × ||x - y||²)</div>
                  <div className="text-slate-500 mt-2"># 결정 함수</div>
                  <div>f(x) = Σ αᵢ × yᵢ × K(xᵢ, x) + b</div>
                  <div className="text-slate-500 mt-2"># 하이퍼파라미터</div>
                  <div>C = <span className="text-yellow-300">10</span> (정규화 강도)</div>
                  <div>γ = <span className="text-yellow-300">auto</span> (1 / n_features)</div>
                  <div className="text-slate-500 mt-2"># 클래스 가중치 (불균형 보정)</div>
                  <div>class_weight = <span className="text-cyan-300">'balanced'</span></div>
                  <div>wᵢ = n_samples / (n_classes × count(classᵢ))</div>
                </div>
                <div className="mt-2 text-slate-400">
                  <strong>왜 SVM?</strong> 고차원(512)에서 효과적, 과적합 방지, 적은 데이터에 강건
                </div>
              </div>
              <div className="bg-purple-900/20 border border-purple-500/30 rounded p-3">
                <div className="text-purple-400 font-semibold mb-2">Isolation Forest 이상 탐지</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 원리: 이상치는 고립시키기 쉽다</div>
                  <div className="mt-1">1. 랜덤 특징 선택</div>
                  <div>2. 랜덤 분할점 선택 (min ~ max 사이)</div>
                  <div>3. 재귀적으로 트리 구축</div>
                  <div>4. <span className="text-yellow-300">경로 길이</span> = 고립에 필요한 분할 수</div>
                  <div className="text-slate-500 mt-2"># 이상 점수 계산</div>
                  <div>s(x) = 2^(-E[h(x)] / c(n))</div>
                  <div>• s ≈ 1: 확실한 이상</div>
                  <div>• s ≈ 0.5: 정상</div>
                  <div>• s < 0.5: 매우 정상</div>
                  <div className="text-slate-500 mt-2"># 하이퍼파라미터</div>
                  <div>n_estimators = <span className="text-yellow-300">100</span></div>
                  <div>contamination = <span className="text-yellow-300">0.1</span></div>
                </div>
              </div>
              <div className="bg-slate-800 rounded p-3">
                <div className="text-slate-300 font-semibold mb-2">11클래스 분류 체계</div>
                <div className="grid grid-cols-3 gap-2 mt-2">
                  <div className="text-center">
                    <div className="text-red-400 font-semibold">충격성</div>
                    <div className="text-slate-500">knock, tick, clunk</div>
                  </div>
                  <div className="text-center">
                    <div className="text-blue-400 font-semibold">음조성</div>
                    <div className="text-slate-500">whine, squeal, misfire</div>
                  </div>
                  <div className="text-center">
                    <div className="text-green-400 font-semibold">잡음성</div>
                    <div className="text-slate-500">rattle, hiss, grind</div>
                  </div>
                </div>
                <div className="text-center mt-2 text-slate-400">+ healthy + wheel_bearing</div>
              </div>
            </div>
          ),
        },
        {
          n: '4', title: '지식 그래프 쿼리', type: 'symbolic', validation: 'validated',
          content: (
            <div className="bg-slate-800 rounded p-2 text-xs">
              <div className="flex items-center justify-center gap-2 flex-wrap">
                <span className="bg-yellow-900/50 border border-yellow-500/50 rounded px-2 py-1 text-yellow-300">증거벡터</span>
                <span className="text-slate-500">→</span>
                <span className="bg-cyan-900/50 border border-cyan-500/50 rounded px-2 py-1 text-cyan-300">KG.query()</span>
                <span className="text-slate-500">→</span>
                <span className="bg-green-900/50 border border-green-500/50 rounded px-2 py-1 text-green-300">30개 후보 고장</span>
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-purple-900/20 border border-purple-500/30 rounded p-3">
                <div className="text-purple-400 font-semibold mb-2">지식 그래프 구조 (이분 그래프)</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 노드 유형</div>
                  <div><span className="text-red-400">고장 노드</span>: 30개 (진동 22 + OBD 8)</div>
                  <div><span className="text-cyan-400">증상 노드</span>: 59개 (소리 9 + 진동 15 + OBD 20 + DTC 15)</div>
                  <div className="text-slate-500 mt-2"># 에지: 고장 → 증상 (조건부 확률)</div>
                  <div><span className="text-red-400">rod_bearing</span> ──0.90──→ <span className="text-cyan-300">sound_knock</span></div>
                  <div><span className="text-red-400">rod_bearing</span> ──0.85──→ <span className="text-green-300">vib_high_kurtosis</span></div>
                  <div><span className="text-red-400">rod_bearing</span> ──0.90──→ <span className="text-green-300">vib_2x_order</span></div>
                  <div><span className="text-orange-400">vacuum_leak</span> ──0.90──→ <span className="text-cyan-300">sound_hiss</span></div>
                  <div><span className="text-orange-400">vacuum_leak</span> ──0.95──→ <span className="text-blue-300">dtc_p0171</span></div>
                </div>
              </div>
              <div className="bg-cyan-900/20 border border-cyan-500/30 rounded p-3">
                <div className="text-cyan-400 font-semibold mb-2">쿼리 알고리즘 (4단계)</div>
                <div className="space-y-2">
                  <div className="bg-slate-900 rounded p-2">
                    <div className="text-yellow-400 font-semibold">1단계: 증상 수집</div>
                    <div className="font-mono text-xs mt-1">
                      <div>all_symptoms = {'{'}</div>
                      <div className="text-cyan-300 ml-2">"sound_knock": 0.85, <span className="text-slate-500"># 분류기 출력</span></div>
                      <div className="text-green-300 ml-2">"vib_high_kurtosis": 0.92, "vib_2x_order": 0.78,</div>
                      <div className="text-purple-300 ml-2">"condition_under_load": 0.9 <span className="text-slate-500"># 사용자 NLU</span></div>
                      <div>{'}'}</div>
                    </div>
                  </div>
                  <div className="bg-slate-900 rounded p-2">
                    <div className="text-yellow-400 font-semibold">2단계: 역방향 조회</div>
                    <div className="font-mono text-xs mt-1">
                      <div className="text-slate-500"># 각 증상에서 해당 고장 찾기</div>
                      <div><span className="text-cyan-300">"sound_knock"</span> → rod_bearing(0.90), main_bearing(0.75)</div>
                      <div><span className="text-green-300">"vib_2x_order"</span> → rod_bearing(0.90), piston_slap(0.60)</div>
                    </div>
                  </div>
                  <div className="bg-slate-900 rounded p-2">
                    <div className="text-yellow-400 font-semibold">3단계: 누락 증거 페널티</div>
                    <div className="font-mono text-xs mt-1">
                      <div className="text-slate-500"># rod_bearing 예상: [knock✓, kurtosis✓, 2x✓] → 페널티 없음</div>
                      <div className="text-slate-500"># main_bearing 예상: [knock✓, 1x✗] → 페널티 -0.05</div>
                    </div>
                  </div>
                  <div className="bg-slate-900 rounded p-2">
                    <div className="text-yellow-400 font-semibold">4단계: 사전확률 + 정규화</div>
                    <div className="font-mono text-xs mt-1">
                      <div>final_score = 0.8 × evidence + 0.2 × prior</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ),
        },
        {
          n: '5', title: '연역적 필터링', type: 'symbolic', validation: 'validated',
          content: (
            <div className="bg-slate-800 rounded p-2 text-xs">
              <div className="text-green-400 font-semibold mb-1">경성 제약조건 (물리 & 논리)</div>
              <div className="grid grid-cols-2 gap-2">
                <div className="text-slate-400">• 물리: RPM, 온도, 부하, 발생시점</div>
                <div className="text-slate-400">• 시스템: 연료 트림, DTC 논리</div>
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-red-900/20 border border-red-500/30 rounded p-3">
                <div className="text-red-400 font-semibold mb-2">경성 제약조건 (불가능 제거)</div>
                <div className="bg-slate-900 rounded p-2 space-y-2">
                  <div>
                    <span className="text-red-400 font-semibold">DTC 논리:</span>
                    <div className="text-slate-400 ml-2">P0171 (희박) 존재 → "과농" 고장 제거</div>
                    <div className="text-slate-400 ml-2">P0300 (실화) 없음 → 점화 계통 고장 가능성 ↓</div>
                  </div>
                  <div>
                    <span className="text-red-400 font-semibold">물리 제약:</span>
                    <div className="text-slate-400 ml-2">냉간 시동시만 발생 → 열 관련 고장 제거</div>
                    <div className="text-slate-400 ml-2">주행 중에만 발생 → 아이들 관련 고장 제거</div>
                  </div>
                  <div>
                    <span className="text-red-400 font-semibold">발생 시점:</span>
                    <div className="text-slate-400 ml-2">갑작스러운 발생 → 마모 관련 고장 제거</div>
                    <div className="text-slate-400 ml-2">점진적 악화 → 충돌/충격 고장 제거</div>
                  </div>
                </div>
              </div>
              <div className="bg-yellow-900/20 border border-yellow-500/30 rounded p-3">
                <div className="text-yellow-400 font-semibold mb-2">연성 제약조건 (신뢰도 조정)</div>
                <div className="bg-slate-900 rounded p-2 space-y-2">
                  <div>
                    <span className="text-yellow-400 font-semibold">주행거리:</span>
                    <div className="text-slate-400 ml-2">고주행 (>150,000km) → 베어링/체인 마모 ↑</div>
                  </div>
                  <div>
                    <span className="text-yellow-400 font-semibold">연료 트림:</span>
                    <div className="text-slate-400 ml-2">LTFT > +15% → 연료 시스템 고장 ↑</div>
                  </div>
                  <div>
                    <span className="text-yellow-400 font-semibold">부하 상관관계:</span>
                    <div className="text-slate-400 ml-2">부하 시 악화 → 베어링 고장 ↑</div>
                  </div>
                </div>
              </div>
              <div className="bg-green-900/20 border border-green-500/30 rounded p-3">
                <div className="text-green-400 font-semibold mb-2">안전 바닥 (Floor)</div>
                <div className="text-slate-400">
                  <div>• 모든 후보가 제거되지 않도록 보장</div>
                  <div>• 최소 1개 가설 항상 유지</div>
                  <div>• "알 수 없음" 보다 "불확실하지만 가능성 있음"</div>
                </div>
              </div>
            </div>
          ),
        },
        {
          n: '6', title: '귀추적 순위화', type: 'hybrid', validation: 'validated',
          content: (
            <div className="bg-slate-800 rounded p-2 text-xs">
              <div className="text-blue-400 font-semibold mb-1">베이지안 논리 + 추론</div>
              <div className="space-y-1">
                {[
                  { fault: '로드 노킹', score: '0.85', top: true },
                  { fault: '메인 베어링', score: '0.12', top: false },
                ].map((h, i) => (
                  <div key={i} className={`flex justify-between p-1 rounded ${h.top ? 'bg-blue-900/30' : 'bg-slate-900'}`}>
                    <span className={h.top ? 'text-white' : 'text-slate-400'}>{h.fault}</span>
                    <span className={h.top ? 'text-blue-300' : 'text-slate-500'}>{h.score}</span>
                  </div>
                ))}
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-blue-900/20 border border-blue-500/30 rounded p-3">
                <div className="text-blue-400 font-semibold mb-2">베이지안 스코어링 공식</div>
                <div className="bg-slate-900 rounded p-2">
                  <div className="text-center text-lg font-mono text-blue-300 py-2">
                    P(고장|증거) ∝ P(증거|고장) × P(고장)
                  </div>
                  <div className="mt-2 space-y-1">
                    <div><span className="text-yellow-400">P(증거|고장)</span>: KG 에지 가중치 (0~1)</div>
                    <div><span className="text-yellow-400">P(고장)</span>: 사전 확률 (고장 빈도 기반)</div>
                    <div><span className="text-yellow-400">진단 가중치</span>: 증상별 중요도</div>
                  </div>
                </div>
              </div>
              <div className="bg-slate-900 rounded p-3">
                <div className="text-slate-300 font-semibold mb-2">스코어링 예시</div>
                <div className="grid grid-cols-2 gap-3 mt-2">
                  <div className="bg-blue-900/30 rounded p-2">
                    <div className="text-blue-300 font-semibold">로드 베어링</div>
                    <div className="text-slate-400 text-xs mt-1">
                      <div>+0.30 knock 일치</div>
                      <div>+0.25 부하시 악화</div>
                      <div>+0.20 2x 오더 검출</div>
                      <div>+0.10 고 첨도</div>
                      <div className="border-t border-slate-700 mt-1 pt-1">
                        <span className="text-green-400 font-bold">= 0.85</span>
                      </div>
                    </div>
                  </div>
                  <div className="bg-slate-800 rounded p-2">
                    <div className="text-slate-400 font-semibold">메인 베어링</div>
                    <div className="text-slate-500 text-xs mt-1">
                      <div>+0.30 knock 일치</div>
                      <div>+0.15 부하시 악화</div>
                      <div>-0.15 1x 오더 없음</div>
                      <div>-0.10 주파수 불일치</div>
                      <div className="border-t border-slate-700 mt-1 pt-1">
                        <span className="text-slate-400 font-bold">= 0.12</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div className="bg-green-900/20 border border-green-500/30 rounded p-3">
                <div className="text-green-400 font-semibold mb-2">귀추적 추론이란?</div>
                <div className="text-slate-400">
                  <div><strong>귀추법 (Abduction):</strong> 관찰된 증거를 가장 잘 설명하는 가설 선택</div>
                  <div className="mt-2">
                    <div>• <span className="text-cyan-300">연역</span>: 규칙 + 원인 → 결과 예측</div>
                    <div>• <span className="text-yellow-300">귀납</span>: 많은 관찰 → 규칙 도출</div>
                    <div>• <span className="text-green-300">귀추</span>: 결과 + 규칙 → 최적 원인 추론</div>
                  </div>
                </div>
              </div>
            </div>
          ),
        },
        {
          n: '7', title: '출력', type: 'hybrid', validation: 'validated', llm: true,
          content: (
            <div className="bg-gradient-to-r from-slate-800 via-slate-900 to-pink-900/20 rounded p-3 border border-pink-500/50 text-xs">
              <div className="flex justify-between items-center mb-2">
                <span className="text-white font-bold">로드 베어링 마모</span>
                <div className="flex items-center gap-2">
                  <span className="bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">72%</span>
                  <span className="text-pink-400 text-xs">✨ LLM</span>
                </div>
              </div>
              <div className="bg-pink-900/20 border border-pink-500/30 rounded p-2 text-pink-200 italic">
                "노킹 소리와 2x 오더 고조파의 조합은 로드 베어링 간극 증가를 나타냅니다..."
              </div>
            </div>
          ),
          details: (
            <div className="text-xs text-slate-300 space-y-3">
              <div className="bg-pink-900/20 border border-pink-500/30 rounded p-3">
                <div className="text-pink-400 font-semibold mb-2">LLM 설명 생성 과정</div>
                <div className="bg-slate-900 rounded p-2 font-mono text-xs">
                  <div className="text-slate-500"># 1. 진단 결과 구조화</div>
                  <div>diagnosis = {'{'}</div>
                  <div className="ml-2">"fault": "rod_bearing",</div>
                  <div className="ml-2">"confidence": 0.72,</div>
                  <div className="ml-2">"evidence": ["sound_knock", "vib_2x_order", "under_load"],</div>
                  <div className="ml-2">"reasoning_path": [KG edges...]</div>
                  <div>{'}'}</div>
                  <div className="text-slate-500 mt-2"># 2. LLM 프롬프트 구성</div>
                  <div className="text-pink-300">"사용자가 '{'{user_description}'}'라고 설명했습니다.</div>
                  <div className="text-pink-300">진단 결과와 증거를 바탕으로 이해하기 쉽게 설명해주세요."</div>
                  <div className="text-slate-500 mt-2"># 3. 자연어 보고서 생성</div>
                  <div>LLM → 맥락 인식, 다국어 (한/영) 지원</div>
                </div>
              </div>
              <div className="bg-slate-900 rounded p-3">
                <div className="text-slate-300 font-semibold mb-2">출력 구성요소</div>
                <div className="space-y-2">
                  <div className="flex gap-2">
                    <span className="text-green-400">●</span>
                    <div>
                      <span className="text-green-400 font-semibold">진단:</span>
                      <span className="text-slate-400"> 고장명 + 신뢰도 %</span>
                    </div>
                  </div>
                  <div className="flex gap-2">
                    <span className="text-pink-400">●</span>
                    <div>
                      <span className="text-pink-400 font-semibold">설명:</span>
                      <span className="text-slate-400"> LLM 생성 추론 내러티브</span>
                    </div>
                  </div>
                  <div className="flex gap-2">
                    <span className="text-blue-400">●</span>
                    <div>
                      <span className="text-blue-400 font-semibold">조치:</span>
                      <span className="text-slate-400"> 우선순위화된 확인 단계</span>
                    </div>
                  </div>
                  <div className="flex gap-2">
                    <span className="text-yellow-400">●</span>
                    <div>
                      <span className="text-yellow-400 font-semibold">긴급도:</span>
                      <span className="text-slate-400"> 즉시 / 조속 / 예약 / 모니터링</span>
                    </div>
                  </div>
                </div>
              </div>
              <div className="bg-slate-900 rounded p-3">
                <div className="text-slate-300 font-semibold mb-2">계층적 폴백</div>
                <div className="flex items-center gap-2 flex-wrap text-xs">
                  <span className="bg-green-900/50 text-green-400 px-2 py-1 rounded">rod_bearing (>60%)</span>
                  <span className="text-slate-500">→</span>
                  <span className="bg-yellow-900/50 text-yellow-400 px-2 py-1 rounded">하부 엔드 문제 (40-60%)</span>
                  <span className="text-slate-500">→</span>
                  <span className="bg-orange-900/50 text-orange-400 px-2 py-1 rounded">엔진 기계적 문제 (20-40%)</span>
                  <span className="text-slate-500">→</span>
                  <span className="bg-red-900/50 text-red-400 px-2 py-1 rounded">전문가 점검 권장 (<20%)</span>
                </div>
                <div className="mt-2 text-slate-400">
                  <strong>목적:</strong> 증거가 부족해도 항상 실행 가능한 안내 제공
                </div>
              </div>
            </div>
          ),
        },
      ];

      return (
        <div className="space-y-2">
          {stages.map((s, i) => (
            <div key={i}>
              <div className={`rounded-lg border overflow-hidden ${s.llm ? 'bg-gradient-to-r from-slate-900/50 to-pink-900/10 border-pink-500/30' : 'bg-slate-900/50 border-slate-700'}`}>
                <div className="p-3">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <span className="bg-slate-700 text-slate-300 text-xs font-bold w-6 h-6 rounded flex items-center justify-center">{s.n}</span>
                      <span className="text-blue-400 text-sm font-semibold">{s.title}</span>
                      <LLMBadge enabled={s.llm} />
                    </div>
                    <div className="flex items-center gap-2">
                      <TypeBadge type={s.type} />
                      <ValidationBadge status={s.validation} />
                    </div>
                  </div>
                  {s.content}
                </div>
                {s.details && (
                  <>
                    <button
                      onClick={() => setExpanded(expanded === i ? null : i)}
                      className="w-full px-3 py-1.5 bg-slate-800/50 border-t border-slate-700 flex items-center justify-between text-xs text-slate-500 hover:bg-slate-800 hover:text-slate-300 transition-colors"
                    >
                      <span>상세 보기</span>
                      <span className="text-lg">{expanded === i ? '−' : '+'}</span>
                    </button>
                    {expanded === i && (
                      <div className="px-3 py-3 bg-slate-800/30 border-t border-slate-700">
                        {s.details}
                      </div>
                    )}
                  </>
                )}
              </div>
              {i < stages.length - 1 && <Arrow />}
            </div>
          ))}
        </div>
      );
    };

    // 연구 로그
    const ResearchLog = () => {
      const items = [
        { stage: '1', q: '합성 진동을 앵커 모달리티로?', status: 'resolved', answer: '예. 물리 기반 → 무제한 데이터, 결정론적 고장 시그니처.' },
        { stage: '1', q: '저널 베어링 vs 롤링 엘레먼트 물리?', status: 'resolved', answer: '수정됨: 엔진 베어링은 볼 베어링이 아닌 플레인 저널. TDC 후 15°에서 충격.' },
        { stage: '1', q: '최고 진동 인코더 정확도?', status: 'resolved', answer: '81.9% (원본), 63.9% (물리 보정). 현실적 = 어렵지만 전이 우수.' },
        { stage: '2', q: '최고 오디오 기반 모델 조합?', status: 'resolved', answer: 'AST (768d) + CLAP 멀티스케일 (3072d) = 3840d 결합 → PCA 512 → SVM' },
        { stage: '2', q: '오디오 분류 정확도 상한?', status: 'resolved', answer: '52.4% on 11클래스 (품질 검증 데이터). Healthy=80%, misfire=53%, rattle=50%.' },
        { stage: '2', q: 'Freesound 데이터 품질?', status: 'resolved', answer: '혼합. grind/squeal/clunk는 >50% 이상치. 임베딩 기반 검증으로 제거.' },
        { stage: '2', q: '합성 오디오 생성?', status: 'resolved', answer: '실패. AudioLDM2는 도메인 시프트로 -1.4% 정확도. 사용 금지.' },
        { stage: '2', q: '이상 탐지 AUC?', status: 'resolved', answer: 'AST+CLAP 연결 + Isolation Forest로 0.777.' },
        { stage: '3', q: '2단계 파이프라인 (이상 → 분류)?', status: 'resolved', answer: '실패. 22.9% 종단간 (오류 전파). 대신 단일 11클래스 모델 사용.' },
        { stage: '3', q: 'PANNs CNN14 부가가치?', status: 'resolved', answer: '단독 38.5%, AST+CLAP와 결합해도 개선 없음.' },
        { stage: '3', q: 'AudioMAE 부가가치?', status: 'resolved', answer: '31.8%. 자기지도 사전학습은 이 작업에 도움 안됨.' },
        { stage: '2b', q: '22개 고장 유형 커버리지?', status: 'resolved', answer: 'OBD 미감지 고장 전체: 엔진 내부, 보조장치, 터보, 구동계, 배기.' },
        { stage: '2b', q: '운전 시나리오 필요?', status: 'resolved', answer: '12개 시나리오: cold_start, acceleration, deceleration, idle_hunting, city_drive, highway_merge 등.' },
        { stage: '5', q: '종단간 정확도?', status: 'resolved', answer: 'Recall@3 84.2% 달성.' },
        { stage: '-', q: '다음 단계: 진동 → 오디오 전이?', status: 'open', answer: '계획: 공유 공간으로 실제 오디오 임베딩에 진동 인코더 파인튜닝.' },
        { stage: '-', q: '약한 클래스 개선 (grind, squeal, clunk)?', status: 'open', answer: '더 높은 품질의 실제 데이터 필요. Freesound 샘플이 너무 일반적.' },
      ];

      return (
        <div className="space-y-2">
          {items.map((item, i) => (
            <div key={i} className={`rounded p-2 text-xs ${item.status === 'resolved' ? 'bg-green-900/20 border border-green-500/30' : 'bg-yellow-900/20 border border-yellow-500/30'}`}>
              <div className="flex items-start gap-2">
                <span className="bg-slate-700 text-slate-400 px-1.5 py-0.5 rounded text-xs">S{item.stage}</span>
                <div className="flex-1">
                  <div className={item.status === 'resolved' ? 'text-slate-400' : 'text-yellow-300'}>{item.q}</div>
                  {item.answer && <div className={item.status === 'resolved' ? 'text-green-400 mt-1' : 'text-yellow-400 mt-1'}>→ {item.answer}</div>}
                </div>
                <span className={`px-1.5 py-0.5 rounded text-xs ${item.status === 'resolved' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}`}>
                  {item.status === 'resolved' ? '해결' : '진행중'}
                </span>
              </div>
            </div>
          ))}
        </div>
      );
    };

    function App() {
      const [view, setView] = useState('executive');

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-950 to-slate-900 p-4">
          <h1 className="text-xl font-bold text-center mb-1 bg-gradient-to-r from-orange-400 via-cyan-400 to-purple-400 bg-clip-text text-transparent">
            차량 진단 파이프라인 v6.0
          </h1>
          <p className="text-center text-slate-500 text-xs mb-4">
            <span className="text-orange-400">합성 진동 사전학습</span> •
            <span className="text-cyan-400"> 52.4% 오디오 (11클래스)</span> •
            <span className="text-purple-400"> 63.9% 진동 (22클래스)</span> •
            <span className="text-pink-400"> ✨ LLM</span>
          </p>

          {/* 뷰 전환 */}
          <div className="flex justify-center gap-1 mb-4 flex-wrap">
            {[
              { key: 'executive', label: '개요' },
              { key: 'vibration', label: '진동' },
              { key: 'audio', label: '오디오' },
              { key: 'pipeline', label: '파이프라인' },
              { key: 'research', label: '연구 로그' }
            ].map(v => (
              <button
                key={v.key}
                onClick={() => setView(v.key)}
                className={`px-3 py-1 rounded text-xs font-medium transition ${view === v.key ? 'bg-blue-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                  }`}
              >
                {v.label}
              </button>
            ))}
          </div>

          {/* 검증 요약 */}
          <div className="max-w-3xl mx-auto mb-4 flex justify-center gap-4 text-xs">
            <div className="flex items-center gap-1">
              <span className="text-green-400">●</span>
              <span className="text-slate-400">8/9 검증완료</span>
            </div>
            <div className="flex items-center gap-1">
              <span className="text-purple-400">●</span>
              <span className="text-slate-400">1/9 신규 (진동 사전학습)</span>
            </div>
          </div>

          <div className="max-w-3xl mx-auto">
            {view === 'executive' && <ExecutiveView />}
            {view === 'vibration' && <VibrationView />}
            {view === 'audio' && <AudioView />}
            {view === 'pipeline' && <PipelineView />}
            {view === 'research' && <ResearchLog />}
          </div>

          {/* 범례 */}
          <div className="max-w-3xl mx-auto mt-4 pt-3 border-t border-slate-800 flex justify-center gap-4 text-xs text-slate-500">
            <span><span className="text-purple-400">■</span> 신경망</span>
            <span><span className="text-green-400">■</span> 기호적</span>
            <span><span className="text-blue-400">■</span> 하이브리드</span>
            <span><span className="text-orange-400">■</span> 물리기반</span>
            <span><span className="text-pink-400">✨</span> LLM</span>
          </div>

          <div className="text-center text-xs text-slate-600 mt-3">
            v6.0 — 합성 진동 사전학습 | 물리 보정 | 22개 고장 유형 | 업데이트: 2026-01-28
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>

</html>
