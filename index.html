<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Diagnostic Pipeline v3.2</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const Arrow = () => (
      <div className="flex justify-center py-2">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" strokeWidth="2">
          <path d="M12 5v14M5 12l7 7 7-7"/>
        </svg>
      </div>
    );

    const ExpandIcon = ({ expanded }) => (
      <svg 
        width="16" 
        height="16" 
        viewBox="0 0 24 24" 
        fill="none" 
        stroke="currentColor" 
        strokeWidth="2"
        className={`transition-transform duration-200 ${expanded ? 'rotate-180' : ''}`}
      >
        <path d="M6 9l6 6 6-6"/>
      </svg>
    );

    const Stage = ({ number, title, type, children, details, defaultExpanded = false }) => {
      const [expanded, setExpanded] = useState(defaultExpanded);
      
      const borderColor = type ? {
        neural: 'border-purple-500',
        symbolic: 'border-green-500',
        hybrid: 'border-blue-500',
      }[type] : 'border-slate-600';
      
      const typeBadge = type ? {
        neural: { text: 'Neural', color: 'bg-purple-500/20 text-purple-300' },
        symbolic: { text: 'Symbolic', color: 'bg-green-500/20 text-green-300' },
        hybrid: { text: 'Hybrid', color: 'bg-blue-500/20 text-blue-300' },
      }[type] : null;

      return (
        <div className={`bg-slate-900/50 rounded-xl border-2 ${borderColor} overflow-hidden`}>
          <div className="p-4">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <span className="bg-slate-700 text-slate-300 text-xs font-bold px-2 py-0.5 rounded">{number}</span>
                <span className="text-blue-400 text-sm font-semibold uppercase tracking-wide">{title}</span>
              </div>
              <div className="flex items-center gap-2">
                {typeBadge && (
                  <span className={`text-xs px-2 py-0.5 rounded ${typeBadge.color}`}>{typeBadge.text}</span>
                )}
              </div>
            </div>
            {children}
          </div>
          
          {details && (
            <>
              <button
                onClick={() => setExpanded(!expanded)}
                className="w-full px-4 py-2 bg-slate-800/50 border-t border-slate-700 flex items-center justify-between text-xs text-slate-400 hover:bg-slate-800 transition"
              >
                <span>Technical Details</span>
                <ExpandIcon expanded={expanded} />
              </button>
              
              {expanded && (
                <div className="px-4 py-3 bg-slate-800/30 border-t border-slate-700">
                  {details}
                </div>
              )}
            </>
          )}
        </div>
      );
    };

    function Pipeline() {
      const [activeTab, setActiveTab] = useState('overview');

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-950 to-slate-900 p-6">
          <h1 className="text-2xl font-bold text-center mb-1 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
            Vehicle Diagnostic Pipeline v3.2
          </h1>
          <p className="text-center text-slate-500 text-sm mb-1">Neuro-Symbolic Architecture</p>
          
          {/* Key Badges */}
          <div className="flex justify-center gap-2 mb-2">
            <span className="bg-cyan-500/20 text-cyan-300 text-xs px-2 py-0.5 rounded">üîß Shop Diagnostic Tool</span>
            <span className="bg-slate-700 text-slate-300 text-xs px-2 py-0.5 rounded">Not Real-time Monitoring</span>
          </div>
          <p className="text-center text-yellow-500/70 text-xs mb-4">Early Development</p>
          
          {/* Legend */}
          <div className="flex justify-center gap-4 mb-6 text-xs">
            <div className="flex items-center gap-1">
              <div className="w-3 h-3 rounded bg-purple-500"></div>
              <span className="text-slate-400">Neural</span>
            </div>
            <div className="flex items-center gap-1">
              <div className="w-3 h-3 rounded bg-green-500"></div>
              <span className="text-slate-400">Symbolic</span>
            </div>
            <div className="flex items-center gap-1">
              <div className="w-3 h-3 rounded bg-blue-500"></div>
              <span className="text-slate-400">Hybrid</span>
            </div>
          </div>

          {/* Tabs */}
          <div className="flex justify-center gap-2 mb-6">
            {['overview', 'differentiation', 'output'].map(tab => (
              <button
                key={tab}
                onClick={() => setActiveTab(tab)}
                className={`px-4 py-1.5 rounded-lg text-sm font-medium transition ${
                  activeTab === tab 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                }`}
              >
                {tab.charAt(0).toUpperCase() + tab.slice(1)}
              </button>
            ))}
          </div>

          <div className="max-w-3xl mx-auto space-y-3">
            
            {activeTab === 'overview' && (
              <>
                {/* Stage 1: Inputs */}
                <Stage number="1" title="Inputs"
                  details={
                    <div className="space-y-3">
                      <div className="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-3">
                        <div className="text-cyan-400 text-xs font-semibold mb-2">üîß Shop Setting Context</div>
                        <div className="text-xs text-slate-300 space-y-1">
                          <div>‚Ä¢ Single diagnostic session (not continuous monitoring)</div>
                          <div>‚Ä¢ Technician-initiated capture</div>
                          <div>‚Ä¢ Controlled environment (lift, idle, rev test)</div>
                        </div>
                      </div>
                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ùì Open Questions</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>What signal duration/quality is sufficient for reliable diagnosis?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>Which OBD-II PIDs are essential vs nice-to-have?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>How should we handle missing inputs (no OBD, no audio, etc.)?</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="grid grid-cols-4 gap-2">
                    {[
                      { icon: 'üìä', title: 'Signal', sub: 'Audio/Vibration' },
                      { icon: 'üîå', title: 'OBD-II', sub: 'PIDs + DTCs' },
                      { icon: 'üí¨', title: 'Technician', sub: 'Symptom text' },
                      { icon: 'üöó', title: 'Vehicle', sub: 'Platform/Mileage' },
                    ].map((item, i) => (
                      <div key={i} className="bg-slate-800 rounded-lg p-3 text-center">
                        <div className="text-xl mb-1">{item.icon}</div>
                        <div className="text-white text-xs font-semibold">{item.title}</div>
                        <div className="text-slate-500 text-xs">{item.sub}</div>
                      </div>
                    ))}
                  </div>
                </Stage>

                <Arrow />

                {/* Stage 2: Evidence Extraction */}
                <Stage 
                  number="2" 
                  title="Evidence Extraction" 
                  type="hybrid"
                  details={
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-purple-900/20 border border-purple-500/30 rounded-lg p-3">
                          <div className="text-purple-400 text-xs font-semibold mb-2">üß† Foundation Model <span className="text-slate-500">(Optional)</span></div>
                          <div className="text-xs text-slate-300 space-y-2">
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">Purpose:</div>
                              <div>Semantic audio understanding</div>
                              <div className="text-slate-500">"What does this sound like?"</div>
                            </div>
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">Candidates:</div>
                              <div className="space-y-1">
                                <div><span className="text-purple-300">CLAP</span> - Audio-text similarity</div>
                                <div><span className="text-purple-300">PANNs</span> - AudioSet classifier</div>
                                <div><span className="text-purple-300">BEATs</span> - Audio embeddings</div>
                              </div>
                            </div>
                            <div className="bg-yellow-900/30 border border-yellow-500/30 rounded p-2">
                              <div className="text-yellow-400 text-xs">Note: May not be used for vibration-only domain</div>
                            </div>
                          </div>
                        </div>

                        <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                          <div className="text-green-400 text-xs font-semibold mb-2">üìà Signal Analysis <span className="text-green-300">(Primary)</span></div>
                          <div className="text-xs text-slate-300 space-y-2">
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">Purpose:</div>
                              <div>Physics-based validation</div>
                              <div className="text-slate-500">"Is this from the engine?"</div>
                            </div>
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">Methods:</div>
                              <div className="space-y-1">
                                <div>FFT / Dominant frequency</div>
                                <div>RPM correlation</div>
                                <div>Onset detection</div>
                                <div>Order analysis</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div className="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                        <div className="text-blue-400 text-xs font-semibold mb-2">Why Both Are Needed (when available):</div>
                        <div className="text-xs text-slate-300 space-y-1">
                          <div>‚Ä¢ <span className="text-purple-300">FM alone</span>: Might say "knock" but can't verify it's from engine</div>
                          <div>‚Ä¢ <span className="text-green-300">Signal alone</span>: Knows frequency, but can't distinguish fault types</div>
                          <div>‚Ä¢ <span className="text-blue-300">Combined</span>: "Sounds like rod knock AND correlates with crank speed"</div>
                        </div>
                      </div>

                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ùì Open Questions</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>Can CLAP/PANNs extract meaningful features from vehicle sounds?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>Zero-shot sufficient, or must we fine-tune on automotive data?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>For vibration domain: can signal analysis alone be sufficient?</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="grid grid-cols-2 gap-3">
                    <div className="bg-slate-800 rounded-lg p-3 border border-purple-500/30">
                      <div className="text-purple-400 font-semibold text-xs mb-2">üß† Foundation Model <span className="text-slate-500 font-normal">(Optional)</span></div>
                      <div className="bg-slate-900 rounded p-2 text-xs">
                        <div className="text-slate-300">Semantic Understanding</div>
                        <div className="mt-1 text-slate-500">
                          "What does this sound like?"<br/>
                          <span className="text-purple-300">‚Üí rod_knock: 72%</span>
                        </div>
                      </div>
                    </div>
                    <div className="bg-slate-800 rounded-lg p-3 border border-green-500/30">
                      <div className="text-green-400 font-semibold text-xs mb-2">üìà Signal Analysis <span className="text-green-300 font-normal">(Primary)</span></div>
                      <div className="bg-slate-900 rounded p-2 text-xs">
                        <div className="text-slate-300">Physics Validation</div>
                        <div className="mt-1 text-slate-500">
                          "Is this from the engine?"<br/>
                          <span className="text-green-300">‚Üí crank_speed correlation</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Stage 3: Hypothesis Generation */}
                <Stage 
                  number="3" 
                  title="Hypothesis Generation" 
                  type="symbolic"
                  details={
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                          <div className="text-green-400 text-xs font-semibold mb-2">üìö Fault Knowledge Base</div>
                          <div className="text-xs text-slate-300 space-y-2">
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">What it contains:</div>
                              <div className="space-y-1 text-slate-500">
                                <div>‚Ä¢ Known fault types for target platforms</div>
                                <div>‚Ä¢ Evidence patterns for each fault</div>
                                <div>‚Ä¢ Causal relationships between faults</div>
                                <div>‚Ä¢ Platform-specific information</div>
                              </div>
                            </div>
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">Key principle:</div>
                              <div className="text-slate-500">Closed world - only diagnose known faults</div>
                            </div>
                          </div>
                        </div>

                        <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                          <div className="text-green-400 text-xs font-semibold mb-2">üîç Candidate Selection</div>
                          <div className="text-xs text-slate-300 space-y-2">
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">What it does:</div>
                              <div className="space-y-1 text-slate-500">
                                <div>‚Ä¢ Match evidence to potential faults</div>
                                <div>‚Ä¢ Find faults that could explain symptoms</div>
                                <div>‚Ä¢ Trace to possible root causes</div>
                              </div>
                            </div>
                            <div className="bg-slate-900 rounded p-2">
                              <div className="text-slate-400 mb-1">Key principle:</div>
                              <div className="text-slate-500">Prefer root causes over symptoms</div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div className="bg-slate-800 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">Root Cause Tracing</div>
                        <div className="text-xs text-slate-400 mb-3">Given evidence, trace backward to find root causes:</div>
                        
                        <div className="flex flex-col items-center gap-2">
                          <div className="text-xs text-slate-500 w-full text-center">Observed Symptoms</div>
                          <div className="flex gap-2">
                            <div className="bg-red-900/50 border border-red-500/50 rounded px-2 py-1 text-xs text-red-300">rod_knock</div>
                            <div className="bg-red-900/50 border border-red-500/50 rounded px-2 py-1 text-xs text-red-300">low_oil_pressure</div>
                          </div>
                          
                          <div className="text-slate-500">‚Üí caused by?</div>
                          
                          <div className="text-xs text-slate-500 w-full text-center">Intermediate Cause</div>
                          <div className="flex gap-2">
                            <div className="bg-yellow-900/50 border border-yellow-500/50 rounded px-2 py-1 text-xs text-yellow-300">bearing_wear</div>
                          </div>
                          
                          <div className="text-slate-500">‚Üí caused by?</div>
                          
                          <div className="text-xs text-slate-500 w-full text-center">Possible Root Causes (Candidates)</div>
                          <div className="flex gap-2 flex-wrap justify-center">
                            <div className="bg-green-900/50 border border-green-500/50 rounded px-2 py-1 text-xs text-green-300">oil_starvation</div>
                            <div className="bg-green-900/50 border border-green-500/50 rounded px-2 py-1 text-xs text-green-300">high_mileage_wear</div>
                            <div className="bg-green-900/50 border border-green-500/50 rounded px-2 py-1 text-xs text-green-300">over_revving</div>
                          </div>
                        </div>
                        
                        <div className="mt-3 text-xs text-slate-400 text-center">All root causes become candidate hypotheses for next stage</div>
                      </div>

                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ùì Open Questions</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>What data structure best represents fault relationships? DAG, tree, or flat lookup?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>Should knowledge base be hand-curated, LLM-generated, or extracted from repair manuals?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>How to handle faults not in the knowledge base (unknown unknowns)?</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="bg-slate-800 rounded-lg p-3">
                    <div className="text-xs text-slate-400 mb-2">Root Cause Tracing</div>
                    <div className="flex items-center justify-center gap-2 text-xs flex-wrap">
                      <div className="bg-red-900/50 border border-red-500/50 rounded px-2 py-1 text-red-300">rod_knock</div>
                      <span className="text-slate-500">‚Üê</span>
                      <div className="bg-yellow-900/50 border border-yellow-500/50 rounded px-2 py-1 text-yellow-300">bearing_wear</div>
                      <span className="text-slate-500">‚Üê</span>
                      <div className="bg-green-900/50 border border-green-500/50 rounded px-2 py-1 text-green-300">oil_starvation</div>
                    </div>
                    <div className="text-center text-xs text-slate-500 mt-2">Symptom ‚Üê Intermediate ‚Üê ROOT CAUSE</div>
                  </div>
                </Stage>

                <Arrow />

                {/* Stage 4: Deductive Filtering */}
                <Stage 
                  number="4" 
                  title="Deductive Filtering" 
                  type="symbolic"
                  details={
                    <div className="space-y-4">
                      <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">Purpose</div>
                        <div className="text-xs text-slate-300">
                          Eliminate impossible hypotheses using hard rules that cannot be overridden by any other component (including LLM).
                        </div>
                      </div>

                      <div className="bg-slate-800 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">Types of Hard Constraints</div>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Platform Constraints</div>
                            <div className="text-slate-500 mt-1">Faults that don't exist on this vehicle</div>
                            <div className="text-slate-600 mt-1 text-xs">e.g., N55 has timing chain, not belt</div>
                          </div>
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Physics Constraints</div>
                            <div className="text-slate-500 mt-1">Evidence that must be present for a fault</div>
                            <div className="text-slate-600 mt-1 text-xs">e.g., Rod knock must correlate with crank speed</div>
                          </div>
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Logical Constraints</div>
                            <div className="text-slate-500 mt-1">Mutually exclusive conditions</div>
                            <div className="text-slate-600 mt-1 text-xs">e.g., Can't be both lean and rich simultaneously</div>
                          </div>
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Required Evidence</div>
                            <div className="text-slate-500 mt-1">Mandatory symptoms for certain faults</div>
                            <div className="text-slate-600 mt-1 text-xs">e.g., Vacuum leak requires lean condition</div>
                          </div>
                        </div>
                      </div>

                      <div className="bg-slate-800 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">Why Symbolic (Not Neural)?</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-green-400">‚Ä¢</span>
                            <div><span className="text-white">Deterministic:</span> Same input always gives same output</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-green-400">‚Ä¢</span>
                            <div><span className="text-white">Explainable:</span> Can show exactly why a hypothesis was rejected</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-green-400">‚Ä¢</span>
                            <div><span className="text-white">Reliable:</span> Won't hallucinate or make probabilistic errors</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-green-400">‚Ä¢</span>
                            <div><span className="text-white">Auditable:</span> Rules can be reviewed and verified by domain experts</div>
                          </div>
                        </div>
                      </div>

                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ùì Open Questions</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>How strict should physics constraints be? Allow tolerance or hard cutoff?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>What if signal analysis is uncertain (noisy RPM correlation)?</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="bg-slate-800 rounded-lg p-3">
                    <div className="text-xs text-green-400 font-semibold mb-2">Hard Constraints (Cannot Override)</div>
                    <div className="grid grid-cols-2 gap-2 text-xs">
                      <div className="bg-red-900/30 border border-red-500/30 rounded p-2">
                        <span className="text-red-400">‚úó Lifter tick</span>
                        <div className="text-slate-500">Requires cam_speed</div>
                      </div>
                      <div className="bg-red-900/30 border border-red-500/30 rounded p-2">
                        <span className="text-red-400">‚úó Timing belt</span>
                        <div className="text-slate-500">N55 uses chain</div>
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Stage 5: Abductive Ranking */}
                <Stage 
                  number="5" 
                  title="Abductive Ranking" 
                  type="hybrid"
                  details={
                    <div className="space-y-4">
                      <div className="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                        <div className="text-blue-400 text-xs font-semibold mb-2">What is Abductive Reasoning?</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div>Given observed evidence, find the <span className="text-white">best explanation</span> among candidates.</div>
                          <div className="bg-slate-900 rounded p-2 mt-2">
                            <div className="text-slate-400">Unlike deduction (guaranteed) or induction (probable):</div>
                            <div className="text-slate-500 mt-1">Abduction finds the most <span className="text-blue-300">plausible</span> hypothesis that explains all evidence</div>
                          </div>
                        </div>
                      </div>

                      <div className="bg-slate-800 rounded-lg p-3">
                        <div className="text-blue-400 text-xs font-semibold mb-2">Ranking Criteria</div>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Evidence Coverage</div>
                            <div className="text-slate-500 mt-1">How much evidence does this hypothesis explain?</div>
                          </div>
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Contradictions</div>
                            <div className="text-slate-500 mt-1">Does any evidence contradict this hypothesis?</div>
                          </div>
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Prior Probability</div>
                            <div className="text-slate-500 mt-1">How likely given vehicle context (mileage, history)?</div>
                          </div>
                          <div className="bg-slate-900 rounded p-2">
                            <div className="text-white font-semibold">Causal Depth</div>
                            <div className="text-slate-500 mt-1">Root causes preferred over symptoms</div>
                          </div>
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-purple-900/20 border border-purple-500/30 rounded-lg p-3">
                          <div className="text-purple-400 text-xs font-semibold mb-2">Neural Component (LLM)</div>
                          <div className="text-xs text-slate-300 space-y-1">
                            <div>‚Ä¢ Interpret ambiguous evidence</div>
                            <div>‚Ä¢ Weigh multiple factors holistically</div>
                            <div>‚Ä¢ Handle natural language symptoms</div>
                            <div>‚Ä¢ Reason about "best explanation"</div>
                          </div>
                        </div>
                        <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                          <div className="text-green-400 text-xs font-semibold mb-2">Symbolic Component</div>
                          <div className="text-xs text-slate-300 space-y-1">
                            <div>‚Ä¢ Structured evidence matching</div>
                            <div>‚Ä¢ Consistent confidence calculation</div>
                            <div>‚Ä¢ Countable coverage metrics</div>
                            <div>‚Ä¢ Auditable scoring</div>
                          </div>
                        </div>
                      </div>

                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ùì Open Questions</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>How to weight different evidence sources (audio vs OBD vs technician)?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>Can LLM reliably perform abductive reasoning without hallucinating?</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="bg-slate-800 rounded-lg p-3">
                    <div className="text-xs text-blue-400 font-semibold mb-2">ü§ñ LLM: "What explains ALL evidence?"</div>
                    <div className="space-y-1">
                      {[
                        { fault: 'Rod knock', coverage: '5/5', contra: '1', score: '0.72', top: true },
                        { fault: 'Main bearing', coverage: '4/5', contra: '1', score: '0.58', top: false },
                        { fault: 'Wrist pin', coverage: '3/5', contra: '2', score: '0.34', top: false },
                      ].map((h, i) => (
                        <div key={i} className={`flex items-center justify-between text-xs p-2 rounded ${h.top ? 'bg-blue-900/30 border border-blue-500/30' : 'bg-slate-900'}`}>
                          <span className={h.top ? 'text-white font-semibold' : 'text-slate-400'}>{h.fault}</span>
                          <div className="flex gap-3 text-slate-500">
                            <span>Cov: {h.coverage}</span>
                            <span>Contra: {h.contra}</span>
                            <span className={h.top ? 'text-green-400' : ''}>{h.score}</span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Stage 6: Hierarchical Fallback */}
                <Stage 
                  number="6" 
                  title="Hierarchical Fallback" 
                  type="symbolic"
                  details={
                    <div className="space-y-4">
                      <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">Purpose</div>
                        <div className="text-xs text-slate-300">
                          Ensure the system <span className="text-white">always provides actionable output</span>, even when confidence is low. Never output raw "unknown" - instead, fall back to progressively broader categories.
                        </div>
                      </div>

                      <div className="bg-slate-800 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">Fallback Hierarchy</div>
                        <div className="space-y-2 text-xs">
                          <div className="bg-green-900/30 border border-green-500/30 rounded p-2">
                            <div className="flex justify-between items-center">
                              <div>
                                <span className="text-green-400 font-semibold">Level 1: Specific Fault</span>
                                <div className="text-slate-500 mt-1">e.g., "rod_knock", "vacuum_leak"</div>
                              </div>
                              <span className="text-slate-500">High confidence</span>
                            </div>
                          </div>
                          <div className="bg-yellow-900/30 border border-yellow-500/30 rounded p-2">
                            <div className="flex justify-between items-center">
                              <div>
                                <span className="text-yellow-400 font-semibold">Level 2: Category</span>
                                <div className="text-slate-500 mt-1">e.g., "bottom_end_noise", "intake_leak"</div>
                              </div>
                              <span className="text-slate-500">Medium confidence</span>
                            </div>
                          </div>
                          <div className="bg-orange-900/30 border border-orange-500/30 rounded p-2">
                            <div className="flex justify-between items-center">
                              <div>
                                <span className="text-orange-400 font-semibold">Level 3: System</span>
                                <div className="text-slate-500 mt-1">e.g., "engine_internal", "fuel_system"</div>
                              </div>
                              <span className="text-slate-500">Low confidence</span>
                            </div>
                          </div>
                          <div className="bg-red-900/30 border border-red-500/30 rounded p-2">
                            <div className="flex justify-between items-center">
                              <div>
                                <span className="text-red-400 font-semibold">Level 4: Safe Fallback</span>
                                <div className="text-slate-500 mt-1">"Further inspection recommended"</div>
                              </div>
                              <span className="text-slate-500">Very low / uncertain</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="bg-slate-800 rounded-lg p-3">
                    <div className="flex items-center justify-between text-xs">
                      <div className="flex items-center gap-2">
                        <div className="bg-green-900/50 border border-green-500/50 rounded px-2 py-1">
                          rod_knock (0.72)
                        </div>
                      </div>
                      <div className="text-slate-500">
                        Fallbacks: bottom_end ‚Üí engine_internal ‚Üí inspect
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Stage 7: Output */}
                <Stage number="7" title="Diagnosis Output" type="hybrid"
                  details={
                    <div className="space-y-3">
                      <div className="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-3">
                        <div className="text-cyan-400 text-xs font-semibold mb-2">üîß For Technicians</div>
                        <div className="text-xs text-slate-300 space-y-1">
                          <div>‚Ä¢ Specific fault with confidence level</div>
                          <div>‚Ä¢ Supporting and contradicting evidence</div>
                          <div>‚Ä¢ Recommended verification steps</div>
                          <div>‚Ä¢ Parts/repair suggestions</div>
                        </div>
                      </div>
                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ùì Open Questions</div>
                        <div className="text-xs text-slate-300 space-y-2">
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>What information is most actionable for technicians?</div>
                          </div>
                          <div className="flex items-start gap-2">
                            <span className="text-yellow-500">‚Ä¢</span>
                            <div>How to present contradicting evidence without confusion?</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                >
                  <div className="bg-gradient-to-r from-slate-800 to-slate-900 rounded-lg p-4 border border-blue-500">
                    <div className="flex justify-between items-center mb-3">
                      <div className="text-white font-bold">üîß Rod Bearing Wear</div>
                      <div className="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full">72%</div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-3 text-xs">
                      <div>
                        <div className="text-green-400 font-semibold mb-1">Supporting</div>
                        <div className="space-y-1 text-slate-300">
                          <div>‚úì Signal: rod_knock pattern</div>
                          <div>‚úì Crank speed correlation</div>
                          <div>‚úì Worse when warm</div>
                        </div>
                      </div>
                      <div>
                        <div className="text-yellow-400 font-semibold mb-1">Contradicting</div>
                        <div className="space-y-1 text-slate-300">
                          <div>‚ö† Oil pressure NORMAL</div>
                        </div>
                      </div>
                    </div>

                    <div className="mt-3 bg-yellow-900/30 border border-yellow-500/50 rounded p-2 text-xs">
                      <span className="text-yellow-400 font-semibold">Implication: </span>
                      <span className="text-yellow-200">Early-stage wear OR sensor fault</span>
                    </div>
                  </div>
                </Stage>
              </>
            )}

            {activeTab === 'differentiation' && (
              <>
                {/* Core Approach */}
                <Stage number="1" title="Core Approach Difference">
                  <div className="grid grid-cols-2 gap-3 text-xs">
                    <div className="bg-red-900/20 border border-red-500/30 rounded-lg p-3">
                      <div className="text-red-400 font-semibold mb-2">‚ùå Pattern Classification</div>
                      <div className="text-slate-300 space-y-1">
                        <div>‚Ä¢ Exclude normal ‚Üí abnormal</div>
                        <div>‚Ä¢ Single prediction model</div>
                        <div>‚Ä¢ Real-time continuous monitoring</div>
                        <div>‚Ä¢ In-vehicle deployment</div>
                      </div>
                    </div>
                    <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                      <div className="text-green-400 font-semibold mb-2">‚úì Hypothesis-Driven Diagnosis</div>
                      <div className="text-slate-300 space-y-1">
                        <div>‚Ä¢ Generate ‚Üí Verify ‚Üí Rank</div>
                        <div>‚Ä¢ 7-stage separated pipeline</div>
                        <div>‚Ä¢ Single diagnostic session</div>
                        <div>‚Ä¢ Shop/service bay tool</div>
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Architecture */}
                <Stage number="2" title="Architecture Difference">
                  <div className="grid grid-cols-2 gap-3 text-xs">
                    <div className="bg-red-900/20 border border-red-500/30 rounded-lg p-3">
                      <div className="text-red-400 font-semibold mb-2">‚ùå Neural-Only</div>
                      <div className="text-slate-300 space-y-1">
                        <div>‚Ä¢ Single NN for prediction</div>
                        <div>‚Ä¢ Fused preprocessing</div>
                        <div>‚Ä¢ Black-box decisions</div>
                      </div>
                    </div>
                    <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                      <div className="text-green-400 font-semibold mb-2">‚úì Neuro-Symbolic Hybrid</div>
                      <div className="text-slate-300 space-y-1">
                        <div>‚Ä¢ Symbolic deductive filtering</div>
                        <div>‚Ä¢ LLM abductive reasoning</div>
                        <div>‚Ä¢ Explainable decisions</div>
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Knowledge Base */}
                <Stage number="3" title="Knowledge Base Difference">
                  <div className="grid grid-cols-2 gap-3 text-xs">
                    <div className="bg-red-900/20 border border-red-500/30 rounded-lg p-3">
                      <div className="text-red-400 font-semibold mb-2">‚ùå Feature Matching</div>
                      <div className="text-slate-300 space-y-1">
                        <div>‚Ä¢ Fault ‚Üí characteristic values</div>
                        <div>‚Ä¢ Peak, frequency band lookup</div>
                        <div>‚Ä¢ Pattern similarity</div>
                      </div>
                    </div>
                    <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                      <div className="text-green-400 font-semibold mb-2">‚úì Causal Reasoning</div>
                      <div className="text-slate-300 space-y-1">
                        <div>‚Ä¢ Causal chain tracing</div>
                        <div>‚Ä¢ Root cause inference</div>
                        <div>‚Ä¢ Hard constraint rules</div>
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Use Case */}
                <Stage number="4" title="Use Case Difference">
                  <div className="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-3">
                    <div className="text-cyan-400 text-xs font-semibold mb-3">üîß Shop Diagnostic Setting</div>
                    <div className="grid grid-cols-2 gap-4 text-xs">
                      <div className="space-y-2">
                        <div className="text-slate-400 font-semibold">NOT:</div>
                        <div className="text-slate-500 space-y-1">
                          <div>‚Ä¢ Continuous monitoring</div>
                          <div>‚Ä¢ In-vehicle deployment</div>
                          <div>‚Ä¢ Real-time alerts</div>
                          <div>‚Ä¢ Driving pattern analysis</div>
                        </div>
                      </div>
                      <div className="space-y-2">
                        <div className="text-slate-400 font-semibold">IS:</div>
                        <div className="text-slate-300 space-y-1">
                          <div>‚Ä¢ Single session diagnosis</div>
                          <div>‚Ä¢ Technician-initiated</div>
                          <div>‚Ä¢ Controlled environment</div>
                          <div>‚Ä¢ Root cause identification</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </Stage>

                <Arrow />

                {/* Unique Features */}
                <Stage number="5" title="Unique Technical Features">
                  <div className="space-y-2">
                    {[
                      { feature: 'Hard Constraint Deductive Filtering', desc: 'Symbolic rules that cannot be overridden' },
                      { feature: 'Abductive "Best Explanation" Inference', desc: 'LLM-based hypothesis ranking' },
                      { feature: 'Hierarchical Fallback System', desc: 'Graceful degradation with uncertainty' },
                      { feature: 'Causal Chain Root Cause Tracing', desc: 'Symptom ‚Üí intermediate ‚Üí root cause' },
                      { feature: 'Foundation Model (Optional)', desc: 'Zero-shot audio understanding when applicable' },
                    ].map((item, i) => (
                      <div key={i} className="bg-slate-800 rounded-lg p-3 flex items-center justify-between">
                        <div>
                          <div className="text-green-400 text-xs font-semibold">{item.feature}</div>
                          <div className="text-slate-500 text-xs">{item.desc}</div>
                        </div>
                        <span className="text-green-400">‚úì</span>
                      </div>
                    ))}
                  </div>
                </Stage>

                <Arrow />

                {/* Summary */}
                <Stage number="‚úì" title="Summary">
                  <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                    <div className="text-green-400 text-sm font-semibold mb-2">Key Differentiation</div>
                    <div className="text-slate-300 text-xs space-y-2">
                      <div><span className="text-white font-semibold">Approach:</span> Inference Engine vs Pattern Classifier</div>
                      <div><span className="text-white font-semibold">Architecture:</span> Neuro-Symbolic Hybrid vs Neural-Only</div>
                      <div><span className="text-white font-semibold">Use Case:</span> Shop Diagnostic Tool vs In-Vehicle Monitoring</div>
                      <div><span className="text-white font-semibold">Reasoning:</span> Hypothesis Generation + Verification vs Anomaly Detection</div>
                    </div>
                  </div>
                </Stage>
              </>
            )}

            {activeTab === 'output' && (
              <>
                {/* JSON Schema */}
                <Stage number="API" title="Output Schema">
                  <pre className="text-xs text-slate-300 bg-slate-800 rounded p-3 overflow-x-auto">
{`{
  "diagnosis": {
    "fault": "rod_knock",
    "level": "specific",
    "confidence": 0.72,
    "severity": "critical"
  },
  "evidence": {
    "supporting": [
      {"source": "signal", "claim": "rod_knock pattern detected"},
      {"source": "signal", "claim": "crank_speed correlation 0.89"}
    ],
    "contradicting": [
      {"source": "obd", "claim": "Oil pressure normal (32 PSI)"}
    ]
  },
  "reasoning": {
    "hypotheses_generated": 12,
    "hypotheses_filtered": 9,
    "top_candidates": ["rod_knock", "main_bearing", "wrist_pin"]
  },
  "action": {
    "verification": "Manual oil pressure test at idle",
    "expected": "<15 PSI confirms bearing failure"
  }
}`}
                  </pre>
                </Stage>

                <Arrow />

                {/* Technician Display */}
                <Stage number="UI" title="Technician Display">
                  <div className="bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-5 border-2 border-blue-500">
                    <div className="flex justify-between items-start mb-4">
                      <div>
                        <div className="text-red-400 text-xs font-semibold uppercase">‚ö†Ô∏è Critical</div>
                        <div className="text-white text-xl font-bold mt-1">Rod Bearing Wear</div>
                      </div>
                      <div className="text-right">
                        <div className="text-slate-400 text-xs">Confidence</div>
                        <div className="text-3xl font-bold text-blue-400">72%</div>
                      </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mb-4">
                      <div className="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                        <div className="text-green-400 text-xs font-semibold mb-2">‚úì Supporting</div>
                        <ul className="text-xs text-slate-300 space-y-1">
                          <li>‚Ä¢ Signal matches knock pattern</li>
                          <li>‚Ä¢ Correlates with crank speed</li>
                          <li>‚Ä¢ Worse when warm</li>
                        </ul>
                      </div>
                      <div className="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <div className="text-yellow-400 text-xs font-semibold mb-2">‚ö† Contradicting</div>
                        <ul className="text-xs text-slate-300 space-y-1">
                          <li>‚Ä¢ Oil pressure normal</li>
                        </ul>
                        <div className="text-xs text-slate-500 mt-1">Expected: low</div>
                      </div>
                    </div>

                    <div className="bg-slate-800/50 rounded-lg p-3">
                      <div className="text-slate-400 text-xs font-semibold">Recommended Verification</div>
                      <div className="text-sm text-slate-300">Manual oil pressure test at idle when warm</div>
                      <div className="text-xs text-slate-500">&lt;15 PSI confirms bearing failure</div>
                    </div>
                  </div>
                </Stage>
              </>
            )}

            {/* Footer */}
            <div className="mt-6 pt-4 border-t border-slate-800">
              <div className="grid grid-cols-6 gap-2">
                {[
                  { icon: 'üìà', name: 'Signal', type: 'DSP' },
                  { icon: 'üß†', name: 'FM', type: 'Optional' },
                  { icon: 'üîó', name: 'KB', type: 'Causal' },
                  { icon: 'ü§ñ', name: 'LLM', type: 'Abduction' },
                  { icon: '‚úì', name: 'Rules', type: 'Deduction' },
                  { icon: 'üìä', name: 'UQ', type: 'Confidence' },
                ].map((t, i) => (
                  <div key={i} className="bg-slate-800/50 rounded-lg p-2 text-center">
                    <div className="text-lg">{t.icon}</div>
                    <div className="text-xs text-white font-medium">{t.name}</div>
                    <div className="text-xs text-slate-500">{t.type}</div>
                  </div>
                ))}
              </div>
              <div className="text-center text-xs text-slate-600 mt-3">
                Shop Diagnostic Tool ‚Ä¢ Hypothesis-Driven ‚Ä¢ Neuro-Symbolic
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<Pipeline />);
  </script>
</body>
</html>
